{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.executeSideEffects = executeSideEffects;\nexports.mergeState = mergeState;\nexports.default = useCreateReducerWithEffect;\nexports.composeReducers = composeReducers;\nexports.SideEffect = exports.UpdateWithSideEffect = exports.NoUpdate = exports.Update = exports.NO_UPDATE_SYMBOL = void 0;\n\nvar _react = require(\"react\"); // for testing\n\n\nconst NO_UPDATE_SYMBOL = Symbol(\"NO_UPDATE_SYMBOL\");\nexports.NO_UPDATE_SYMBOL = NO_UPDATE_SYMBOL;\n\nconst Update = state => ({\n  state\n});\n\nexports.Update = Update;\n\nconst NoUpdate = () => NO_UPDATE_SYMBOL;\n\nexports.NoUpdate = NoUpdate;\n\nconst UpdateWithSideEffect = (state, sideEffects) => ({\n  state,\n  sideEffects\n});\n\nexports.UpdateWithSideEffect = UpdateWithSideEffect;\n\nconst SideEffect = sideEffects => ({\n  sideEffects\n}); //for testting\n\n\nexports.SideEffect = SideEffect;\n\nasync function executeSideEffects({\n  sideEffects,\n  state,\n  dispatch\n}) {\n  let cancelFuncs = [];\n\n  if (sideEffects) {\n    while (sideEffects.length) {\n      const sideEffect = sideEffects.shift();\n      const cancel = sideEffect(state, dispatch);\n\n      if (cancel && typeof cancel === \"function\") {\n        cancelFuncs.push(cancel);\n      }\n    }\n  }\n\n  return Promise.resolve(cancelFuncs);\n} // for testing\n\n\nfunction mergeState(prevState, newState, isUpdate) {\n  const existingEffects = isUpdate ? prevState.sideEffects : [];\n  const newSideEffects = newState.sideEffects ? [...existingEffects, ...(Array.isArray(newState.sideEffects) ? newState.sideEffects : [newState.sideEffects])] : prevState.sideEffects;\n  const hasNewState = typeof newState.hasOwnProperty === 'function' && newState.hasOwnProperty('state');\n  let updatedState;\n\n  if (isUpdate) {\n    updatedState = hasNewState ? newState.state : prevState.state;\n  } else {\n    updatedState = newState.state;\n  }\n\n  return {\n    state: updatedState,\n    sideEffects: newSideEffects\n  };\n}\n\nfunction finalReducer(reducer) {\n  return function (state, action) {\n    if (action === NO_UPDATE_SYMBOL) {\n      return state;\n    }\n\n    let newState = reducer(state.state, action);\n    return mergeState(state, newState, true);\n  };\n}\n\nfunction useCreateReducerWithEffect(reducer, initialState, init) {\n  const memoizedReducer = (0, _react.useCallback)(finalReducer(reducer), [reducer]);\n  const [{\n    state,\n    sideEffects\n  }, dispatch] = (0, _react.useReducer)(memoizedReducer, {\n    state: initialState,\n    sideEffects: []\n  }, state => {\n    let newState;\n\n    if (typeof init === 'function') {\n      newState = init(state);\n    }\n\n    return typeof newState !== 'undefined' ? mergeState(state, newState, false) : state;\n  });\n  let cancelFuncs = (0, _react.useRef)([]);\n  (0, _react.useEffect)(() => {\n    if (sideEffects.length) {\n      async function asyncEffects() {\n        async function runSideEffects() {\n          const cancels = await executeSideEffects({\n            sideEffects,\n            state,\n            dispatch\n          });\n          return cancels;\n        }\n\n        const cancels = await runSideEffects();\n        cancelFuncs.current = cancels;\n      }\n\n      asyncEffects();\n\n      if (cancelFuncs.current.length) {\n        cancelFuncs.current.forEach(func => {\n          func(state);\n          cancelFuncs.current = [];\n        });\n      }\n    }\n  }, [sideEffects]); //eslint-disable-line\n\n  return [state, dispatch];\n}\n\nfunction composeReducers(reducers) {\n  return (state, action) => {\n    let reducerCount = reducers.length;\n    let sideEffects = [];\n    let noUpdateCount = 0;\n    const reducedResult = reducers.reduceRight((prevState, reducer, index) => {\n      // This is to handle the asymmetry in the useReducerWithSideFffect API.\n      // Whereas regular reducers have a consistent API that is state in, state out\n      // useReducerWithSideEffects has state in, state+sideEffects out\n      let state;\n\n      if (index === reducerCount - 1) {\n        state = prevState;\n      } else {\n        state = prevState.state;\n      }\n\n      const result = reducer(state, action);\n      let returnValue; // When we do not have an update, then we increment our no-update counter and\n      // return the previous state.\n\n      if (result === NO_UPDATE_SYMBOL) {\n        noUpdateCount++;\n        returnValue = {\n          state\n        };\n      } else {\n        returnValue = result;\n      }\n\n      if (result && Array.isArray(result.sideEffects)) {\n        sideEffects = sideEffects.concat(result.sideEffects);\n      }\n\n      return returnValue;\n    }, state);\n    const noUpdateOccurred = noUpdateCount === reducerCount;\n\n    if (noUpdateOccurred) {\n      return NO_UPDATE_SYMBOL;\n    }\n\n    return {\n      state: reducedResult && reducedResult.state,\n      sideEffects\n    };\n  };\n}","map":{"version":3,"sources":["C:/Users/DA118/Desktop/react/sitter/frontend_1110/node_modules/use-reducer-with-side-effects/lib/index.js"],"names":["Object","defineProperty","exports","value","executeSideEffects","mergeState","default","useCreateReducerWithEffect","composeReducers","SideEffect","UpdateWithSideEffect","NoUpdate","Update","NO_UPDATE_SYMBOL","_react","require","Symbol","state","sideEffects","dispatch","cancelFuncs","length","sideEffect","shift","cancel","push","Promise","resolve","prevState","newState","isUpdate","existingEffects","newSideEffects","Array","isArray","hasNewState","hasOwnProperty","updatedState","finalReducer","reducer","action","initialState","init","memoizedReducer","useCallback","useReducer","useRef","useEffect","asyncEffects","runSideEffects","cancels","current","forEach","func","reducers","reducerCount","noUpdateCount","reducedResult","reduceRight","index","result","returnValue","concat","noUpdateOccurred"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.executeSideEffects = executeSideEffects;\nexports.mergeState = mergeState;\nexports.default = useCreateReducerWithEffect;\nexports.composeReducers = composeReducers;\nexports.SideEffect = exports.UpdateWithSideEffect = exports.NoUpdate = exports.Update = exports.NO_UPDATE_SYMBOL = void 0;\n\nvar _react = require(\"react\");\n\n// for testing\nconst NO_UPDATE_SYMBOL = Symbol(\"NO_UPDATE_SYMBOL\");\nexports.NO_UPDATE_SYMBOL = NO_UPDATE_SYMBOL;\n\nconst Update = state => ({\n  state\n});\n\nexports.Update = Update;\n\nconst NoUpdate = () => NO_UPDATE_SYMBOL;\n\nexports.NoUpdate = NoUpdate;\n\nconst UpdateWithSideEffect = (state, sideEffects) => ({\n  state,\n  sideEffects\n});\n\nexports.UpdateWithSideEffect = UpdateWithSideEffect;\n\nconst SideEffect = sideEffects => ({\n  sideEffects\n}); //for testting\n\n\nexports.SideEffect = SideEffect;\n\nasync function executeSideEffects({\n  sideEffects,\n  state,\n  dispatch\n}) {\n  let cancelFuncs = [];\n\n  if (sideEffects) {\n    while (sideEffects.length) {\n      const sideEffect = sideEffects.shift();\n      const cancel = sideEffect(state, dispatch);\n\n      if (cancel && typeof cancel === \"function\") {\n        cancelFuncs.push(cancel);\n      }\n    }\n  }\n\n  return Promise.resolve(cancelFuncs);\n} // for testing\n\n\nfunction mergeState(prevState, newState, isUpdate) {\n  const existingEffects = isUpdate ? prevState.sideEffects : [];\n  const newSideEffects = newState.sideEffects ? [...existingEffects, ...(Array.isArray(newState.sideEffects) ? newState.sideEffects : [newState.sideEffects])] : prevState.sideEffects;\n  const hasNewState = typeof newState.hasOwnProperty === 'function' && newState.hasOwnProperty('state');\n  let updatedState;\n\n  if (isUpdate) {\n    updatedState = hasNewState ? newState.state : prevState.state;\n  } else {\n    updatedState = newState.state;\n  }\n\n  return {\n    state: updatedState,\n    sideEffects: newSideEffects\n  };\n}\n\nfunction finalReducer(reducer) {\n  return function (state, action) {\n    if (action === NO_UPDATE_SYMBOL) {\n      return state;\n    }\n\n    let newState = reducer(state.state, action);\n    return mergeState(state, newState, true);\n  };\n}\n\nfunction useCreateReducerWithEffect(reducer, initialState, init) {\n  const memoizedReducer = (0, _react.useCallback)(finalReducer(reducer), [reducer]);\n  const [{\n    state,\n    sideEffects\n  }, dispatch] = (0, _react.useReducer)(memoizedReducer, {\n    state: initialState,\n    sideEffects: []\n  }, state => {\n    let newState;\n\n    if (typeof init === 'function') {\n      newState = init(state);\n    }\n\n    return typeof newState !== 'undefined' ? mergeState(state, newState, false) : state;\n  });\n  let cancelFuncs = (0, _react.useRef)([]);\n  (0, _react.useEffect)(() => {\n    if (sideEffects.length) {\n      async function asyncEffects() {\n        async function runSideEffects() {\n          const cancels = await executeSideEffects({\n            sideEffects,\n            state,\n            dispatch\n          });\n          return cancels;\n        }\n\n        const cancels = await runSideEffects();\n        cancelFuncs.current = cancels;\n      }\n\n      asyncEffects();\n\n      if (cancelFuncs.current.length) {\n        cancelFuncs.current.forEach(func => {\n          func(state);\n          cancelFuncs.current = [];\n        });\n      }\n    }\n  }, [sideEffects]); //eslint-disable-line\n\n  return [state, dispatch];\n}\n\nfunction composeReducers(reducers) {\n  return (state, action) => {\n    let reducerCount = reducers.length;\n    let sideEffects = [];\n    let noUpdateCount = 0;\n    const reducedResult = reducers.reduceRight((prevState, reducer, index) => {\n      // This is to handle the asymmetry in the useReducerWithSideFffect API.\n      // Whereas regular reducers have a consistent API that is state in, state out\n      // useReducerWithSideEffects has state in, state+sideEffects out\n      let state;\n\n      if (index === reducerCount - 1) {\n        state = prevState;\n      } else {\n        state = prevState.state;\n      }\n\n      const result = reducer(state, action);\n      let returnValue; // When we do not have an update, then we increment our no-update counter and\n      // return the previous state.\n\n      if (result === NO_UPDATE_SYMBOL) {\n        noUpdateCount++;\n        returnValue = {\n          state\n        };\n      } else {\n        returnValue = result;\n      }\n\n      if (result && Array.isArray(result.sideEffects)) {\n        sideEffects = sideEffects.concat(result.sideEffects);\n      }\n\n      return returnValue;\n    }, state);\n    const noUpdateOccurred = noUpdateCount === reducerCount;\n\n    if (noUpdateOccurred) {\n      return NO_UPDATE_SYMBOL;\n    }\n\n    return {\n      state: reducedResult && reducedResult.state,\n      sideEffects\n    };\n  };\n}"]},"metadata":{},"sourceType":"script"}